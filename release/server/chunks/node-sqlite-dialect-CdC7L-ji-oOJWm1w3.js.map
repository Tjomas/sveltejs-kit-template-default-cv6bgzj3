{"version":3,"file":"node-sqlite-dialect-CdC7L-ji-oOJWm1w3.js","sources":["../../../node_modules/better-auth/dist/node-sqlite-dialect-CdC7L-ji.mjs"],"sourcesContent":["import { CompiledQuery, DEFAULT_MIGRATION_LOCK_TABLE, DEFAULT_MIGRATION_TABLE, DefaultQueryCompiler, sql } from \"kysely\";\n\n//#region src/adapters/kysely-adapter/node-sqlite-dialect.ts\nvar NodeSqliteAdapter = class {\n\tget supportsCreateIfNotExists() {\n\t\treturn true;\n\t}\n\tget supportsTransactionalDdl() {\n\t\treturn false;\n\t}\n\tget supportsReturning() {\n\t\treturn true;\n\t}\n\tasync acquireMigrationLock() {}\n\tasync releaseMigrationLock() {}\n\tget supportsOutput() {\n\t\treturn true;\n\t}\n};\nvar NodeSqliteDriver = class {\n\t#config;\n\t#connectionMutex = new ConnectionMutex();\n\t#db;\n\t#connection;\n\tconstructor(config) {\n\t\tthis.#config = { ...config };\n\t}\n\tasync init() {\n\t\tthis.#db = this.#config.database;\n\t\tthis.#connection = new NodeSqliteConnection(this.#db);\n\t\tif (this.#config.onCreateConnection) await this.#config.onCreateConnection(this.#connection);\n\t}\n\tasync acquireConnection() {\n\t\tawait this.#connectionMutex.lock();\n\t\treturn this.#connection;\n\t}\n\tasync beginTransaction(connection) {\n\t\tawait connection.executeQuery(CompiledQuery.raw(\"begin\"));\n\t}\n\tasync commitTransaction(connection) {\n\t\tawait connection.executeQuery(CompiledQuery.raw(\"commit\"));\n\t}\n\tasync rollbackTransaction(connection) {\n\t\tawait connection.executeQuery(CompiledQuery.raw(\"rollback\"));\n\t}\n\tasync releaseConnection() {\n\t\tthis.#connectionMutex.unlock();\n\t}\n\tasync destroy() {\n\t\tthis.#db?.close();\n\t}\n};\nvar NodeSqliteConnection = class {\n\t#db;\n\tconstructor(db) {\n\t\tthis.#db = db;\n\t}\n\texecuteQuery(compiledQuery) {\n\t\tconst { sql: sql$1, parameters } = compiledQuery;\n\t\tconst rows = this.#db.prepare(sql$1).all(...parameters);\n\t\treturn Promise.resolve({ rows });\n\t}\n\tasync *streamQuery() {\n\t\tthrow new Error(\"Streaming query is not supported by SQLite driver.\");\n\t}\n};\nvar ConnectionMutex = class {\n\t#promise;\n\t#resolve;\n\tasync lock() {\n\t\twhile (this.#promise) await this.#promise;\n\t\tthis.#promise = new Promise((resolve) => {\n\t\t\tthis.#resolve = resolve;\n\t\t});\n\t}\n\tunlock() {\n\t\tconst resolve = this.#resolve;\n\t\tthis.#promise = void 0;\n\t\tthis.#resolve = void 0;\n\t\tresolve?.();\n\t}\n};\nvar NodeSqliteIntrospector = class {\n\t#db;\n\tconstructor(db) {\n\t\tthis.#db = db;\n\t}\n\tasync getSchemas() {\n\t\treturn [];\n\t}\n\tasync getTables(options = { withInternalKyselyTables: false }) {\n\t\tlet query = this.#db.selectFrom(\"sqlite_schema\").where(\"type\", \"=\", \"table\").where(\"name\", \"not like\", \"sqlite_%\").select(\"name\").$castTo();\n\t\tif (!options.withInternalKyselyTables) query = query.where(\"name\", \"!=\", DEFAULT_MIGRATION_TABLE).where(\"name\", \"!=\", DEFAULT_MIGRATION_LOCK_TABLE);\n\t\tconst tables = await query.execute();\n\t\treturn Promise.all(tables.map(({ name }) => this.#getTableMetadata(name)));\n\t}\n\tasync getMetadata(options) {\n\t\treturn { tables: await this.getTables(options) };\n\t}\n\tasync #getTableMetadata(table) {\n\t\tconst db = this.#db;\n\t\tconst autoIncrementCol = (await db.selectFrom(\"sqlite_master\").where(\"name\", \"=\", table).select(\"sql\").$castTo().execute())[0]?.sql?.split(/[\\(\\),]/)?.find((it) => it.toLowerCase().includes(\"autoincrement\"))?.split(/\\s+/)?.[0]?.replace(/[\"`]/g, \"\");\n\t\treturn {\n\t\t\tname: table,\n\t\t\tcolumns: (await db.selectFrom(sql`pragma_table_info(${table})`.as(\"table_info\")).select([\n\t\t\t\t\"name\",\n\t\t\t\t\"type\",\n\t\t\t\t\"notnull\",\n\t\t\t\t\"dflt_value\"\n\t\t\t]).execute()).map((col) => ({\n\t\t\t\tname: col.name,\n\t\t\t\tdataType: col.type,\n\t\t\t\tisNullable: !col.notnull,\n\t\t\t\tisAutoIncrementing: col.name === autoIncrementCol,\n\t\t\t\thasDefaultValue: col.dflt_value != null\n\t\t\t})),\n\t\t\tisView: true\n\t\t};\n\t}\n};\nvar NodeSqliteQueryCompiler = class extends DefaultQueryCompiler {\n\tgetCurrentParameterPlaceholder() {\n\t\treturn \"?\";\n\t}\n\tgetLeftIdentifierWrapper() {\n\t\treturn \"\\\"\";\n\t}\n\tgetRightIdentifierWrapper() {\n\t\treturn \"\\\"\";\n\t}\n\tgetAutoIncrement() {\n\t\treturn \"autoincrement\";\n\t}\n};\nvar NodeSqliteDialect = class {\n\t#config;\n\tconstructor(config) {\n\t\tthis.#config = { ...config };\n\t}\n\tcreateDriver() {\n\t\treturn new NodeSqliteDriver(this.#config);\n\t}\n\tcreateQueryCompiler() {\n\t\treturn new NodeSqliteQueryCompiler();\n\t}\n\tcreateAdapter() {\n\t\treturn new NodeSqliteAdapter();\n\t}\n\tcreateIntrospector(db) {\n\t\treturn new NodeSqliteIntrospector(db);\n\t}\n};\n\n//#endregion\nexport { NodeSqliteDialect };"],"names":[],"mappings":"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","x_google_ignoreList":[0]}