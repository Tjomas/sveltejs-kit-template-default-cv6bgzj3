{"version":3,"file":"bun-sqlite-dialect-4d24xHgm-DauN1vwX.js","sources":["../../../.svelte-kit/adapter-node/chunks/bun-sqlite-dialect-4d24xHgm.js"],"sourcesContent":["import { CompiledQuery, DefaultQueryCompiler, DEFAULT_MIGRATION_TABLE, DEFAULT_MIGRATION_LOCK_TABLE, sql } from \"kysely\";\nvar BunSqliteAdapter = class {\n  get supportsCreateIfNotExists() {\n    return true;\n  }\n  get supportsTransactionalDdl() {\n    return false;\n  }\n  get supportsReturning() {\n    return true;\n  }\n  async acquireMigrationLock() {\n  }\n  async releaseMigrationLock() {\n  }\n  get supportsOutput() {\n    return true;\n  }\n};\nvar BunSqliteDriver = class {\n  #config;\n  #connectionMutex = new ConnectionMutex();\n  #db;\n  #connection;\n  constructor(config) {\n    this.#config = { ...config };\n  }\n  async init() {\n    this.#db = this.#config.database;\n    this.#connection = new BunSqliteConnection(this.#db);\n    if (this.#config.onCreateConnection) await this.#config.onCreateConnection(this.#connection);\n  }\n  async acquireConnection() {\n    await this.#connectionMutex.lock();\n    return this.#connection;\n  }\n  async beginTransaction(connection) {\n    await connection.executeQuery(CompiledQuery.raw(\"begin\"));\n  }\n  async commitTransaction(connection) {\n    await connection.executeQuery(CompiledQuery.raw(\"commit\"));\n  }\n  async rollbackTransaction(connection) {\n    await connection.executeQuery(CompiledQuery.raw(\"rollback\"));\n  }\n  async releaseConnection() {\n    this.#connectionMutex.unlock();\n  }\n  async destroy() {\n    this.#db?.close();\n  }\n};\nvar BunSqliteConnection = class {\n  #db;\n  constructor(db) {\n    this.#db = db;\n  }\n  executeQuery(compiledQuery) {\n    const { sql: sql$1, parameters } = compiledQuery;\n    const stmt = this.#db.prepare(sql$1);\n    return Promise.resolve({ rows: stmt.all(parameters) });\n  }\n  async *streamQuery() {\n    throw new Error(\"Streaming query is not supported by SQLite driver.\");\n  }\n};\nvar ConnectionMutex = class {\n  #promise;\n  #resolve;\n  async lock() {\n    while (this.#promise) await this.#promise;\n    this.#promise = new Promise((resolve) => {\n      this.#resolve = resolve;\n    });\n  }\n  unlock() {\n    const resolve = this.#resolve;\n    this.#promise = void 0;\n    this.#resolve = void 0;\n    resolve?.();\n  }\n};\nvar BunSqliteIntrospector = class {\n  #db;\n  constructor(db) {\n    this.#db = db;\n  }\n  async getSchemas() {\n    return [];\n  }\n  async getTables(options = { withInternalKyselyTables: false }) {\n    let query = this.#db.selectFrom(\"sqlite_schema\").where(\"type\", \"=\", \"table\").where(\"name\", \"not like\", \"sqlite_%\").select(\"name\").$castTo();\n    if (!options.withInternalKyselyTables) query = query.where(\"name\", \"!=\", DEFAULT_MIGRATION_TABLE).where(\"name\", \"!=\", DEFAULT_MIGRATION_LOCK_TABLE);\n    const tables = await query.execute();\n    return Promise.all(tables.map(({ name }) => this.#getTableMetadata(name)));\n  }\n  async getMetadata(options) {\n    return { tables: await this.getTables(options) };\n  }\n  async #getTableMetadata(table) {\n    const db = this.#db;\n    const autoIncrementCol = (await db.selectFrom(\"sqlite_master\").where(\"name\", \"=\", table).select(\"sql\").$castTo().execute())[0]?.sql?.split(/[\\(\\),]/)?.find((it) => it.toLowerCase().includes(\"autoincrement\"))?.split(/\\s+/)?.[0]?.replace(/[\"`]/g, \"\");\n    return {\n      name: table,\n      columns: (await db.selectFrom(sql`pragma_table_info(${table})`.as(\"table_info\")).select([\n        \"name\",\n        \"type\",\n        \"notnull\",\n        \"dflt_value\"\n      ]).execute()).map((col) => ({\n        name: col.name,\n        dataType: col.type,\n        isNullable: !col.notnull,\n        isAutoIncrementing: col.name === autoIncrementCol,\n        hasDefaultValue: col.dflt_value != null\n      })),\n      isView: true\n    };\n  }\n};\nvar BunSqliteQueryCompiler = class extends DefaultQueryCompiler {\n  getCurrentParameterPlaceholder() {\n    return \"?\";\n  }\n  getLeftIdentifierWrapper() {\n    return '\"';\n  }\n  getRightIdentifierWrapper() {\n    return '\"';\n  }\n  getAutoIncrement() {\n    return \"autoincrement\";\n  }\n};\nvar BunSqliteDialect = class {\n  #config;\n  constructor(config) {\n    this.#config = { ...config };\n  }\n  createDriver() {\n    return new BunSqliteDriver(this.#config);\n  }\n  createQueryCompiler() {\n    return new BunSqliteQueryCompiler();\n  }\n  createAdapter() {\n    return new BunSqliteAdapter();\n  }\n  createIntrospector(db) {\n    return new BunSqliteIntrospector(db);\n  }\n};\nexport {\n  BunSqliteDialect\n};\n"],"names":[],"mappings":"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"}